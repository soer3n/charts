name: release
on: 
  push:
    branches:
      - master
  release:
    types: [published, created]

jobs:
  release:
    runs-on: self-hosted
    strategy:
      matrix:
        charts:
        - 'testing_b'
        - 'testing_a'
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Publish Helm charts
        uses: helm/chart-releaser-action@v1.2.1
        env:
          CR_TOKEN: ${{ secrets.CR_TOKEN }}
        with:
          charts_dir: ${{ matrix.charts }}
          charts_repo_url: https://soer3n.github.io/charts/${{ matrix.charts}}
          config: .github/ct.yaml
