name: release
on: 
  push:
    branches:
      - master
  release:
    types: [published, created]

jobs:
  testing_a:
    runs-on: self-hosted
    needs:
    - lint-chart
    - install-chart
    strategy:
      matrix:
        charts:
        - 'testing_b'
        - 'testing_a'
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Publish Helm charts
        uses: stefanprodan/helm-gh-pages@master
        with:
          token: ${{ secrets.CR_TOKEN }}
          charts_dir: ${{ matrix.charts }}
          target_dir: ${{ matrix.charts }}
